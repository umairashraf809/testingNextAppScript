let t=0,e=0,n=0,o=0,i=0,a=0;const r={h1:0,h2:0,h3:0,h4:0,h5:0,h6:0};let c=0,s=0;const d=new URLSearchParams(window.location.search),l=d.has("diagnostics"),m=t=>{},h=async(t,e)=>{let n=`https://sa.searchatlas.com/api/v2/otto-url-details/?url=${t}`;e&&(n+=`&uuid=${e}`);try{const e=await fetch(n);if(!e.ok)throw new Error("API call failed.");const o=await e.json();m(),window.location.origin+window.location.pathname===t&&f(o)}catch(t){}},u=async(t,e,n)=>{try{const o=navigator.userAgent;if(o.includes("bot")){const i="https://sa.searchatlas.com/api/v2/otto-page-crawl-logs/",a={otto_uuid:e,url:t,user_agent:o,context:n},r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error("API call failed.");await r.json();m()}}catch(t){m()}},y=t=>{let o=!1;const{type:i,name:a,property:r,recommended_value:c}=t,s=document.querySelectorAll("title");if("title"===i)s?.length&&s?.length>1&&s?.forEach(((t,e)=>{s.length-1!==e&&t?.remove()})),o=!1;else{const t=`meta[name="${(a||r)?.trim()}"], meta[property="${(a||r)?.trim()}"]`;o=document.querySelector(t)||!1}if(o)m(),"title"===i?(e++,m(),o.innerHTML=c):(m(),n++,o.setAttribute("content",c));else if("title"===i)if(m(),e++,s?.length>0){document.querySelector("title").innerHTML=c}else{const t=`<title>${c}</title>`;m(),document.head.insertAdjacentHTML("afterbegin",t)}else{m();const t=`<meta ${r?"property":"name"}="${r||a}" content="${c}">`;n++,m(),document.head.insertAdjacentHTML("afterbegin",t)}},_=t=>{const e=document.querySelectorAll("img");e?.forEach((e=>{t?.forEach((([t,n])=>{Array.from(e?.attributes).forEach((o=>{o.value===t&&(c++,m(),e.alt=n)}))}))})),m()},p=t=>(new DOMParser).parseFromString(t,"text/html").documentElement.textContent,f=e=>{DOMPurify.sanitize(e?.body_bottom_html_insertion,{ALLOWED_TAGS:["div","h1","h2","h3","h4","p"],ALLOWED_ATTR:["style","data-otto-pixel","class"]});m(e.header_html_insertion);const n=e.header_html_insertion?`\x3c!-- Dynamic Optimization Header Integration Start --\x3e ${e.header_html_insertion} \x3c!-- Dynamic Optimization Header Integration Ended --\x3e `:"";n&&(document.head.insertAdjacentHTML("afterbegin",n),t++),m();try{m(e.header_replacements),Array.isArray(e.header_replacements)&&e.header_replacements?.forEach((t=>{y(t)})),m(e.header_replacements)}catch(t){m()}const c=document.querySelector("body");m(e.body_top_html_insertion);const d=e.body_top_html_insertion?`\x3c!-- Dynamic Optimization Body Top Integration Start --\x3e ${e.body_top_html_insertion} \x3c!-- Dynamic Optimization Body Top Integration Ended --\x3e `:"";d&&(o++,c.insertAdjacentHTML("afterbegin",d)),m(),m(e.body_bottom_html_insertion);const l=e.body_bottom_html_insertion?`\x3c!-- Dynamic Optimization Body Bottom Integration Start --\x3e ${e.body_bottom_html_insertion} \x3c!-- Dynamic Optimization Body Bottom Integration Ended --\x3e `:"";l&&(i++,c.insertAdjacentHTML("beforeend",l)),m(),m();for(const[t,n]of Object.entries(e.body_substitutions))if("images"!==t)if(m(),"links"===t){const t=Object.entries(n);t.length&&document.querySelectorAll(`a[href="${t[0][0]}"]`)?.forEach((e=>{a++,e.href=t[0][1]}))}else"headings"===t&&n?.forEach((t=>{document.querySelectorAll(t.type)?.forEach((e=>{if(e.textContent.trim()===t.current_value.trim()){m((t.type,e.textContent,t.recommended_value)),r[t.type]++;(e?.lastChild?.nodeType===Node.ELEMENT_NODE?e.lastChild:e).innerHTML=p(e.innerHTML).replace(t.current_value,t.recommended_value)}}))}));if(m(),e.header_replacements?.length>0){const t=e.header_replacements.find((t=>"link"==t?.type&&"canonical"==t?.rel)),n=document.querySelector('link[rel="canonical"]');t&&n&&(n.href=t?.recommended_value)}if(m(),e?.body_substitutions?.images&&_(Object.entries(e?.body_substitutions?.images)),m(),m(e.footer_html_insertion),e.footer_html_insertion){let t=document.querySelector("footer");t||(m(),t=document.createElement("footer"),document.body.appendChild(t),m());const n=e.footer_html_insertion?`\x3c!-- Dynamic Optimization Footer Integration Start --\x3e ${e.footer_html_insertion} \x3c!-- Dynamic Optimization Footer Integration Ended --\x3e `:"";s++,t.insertAdjacentHTML("beforeend",n),m()}m(e.footer_html_insertion),m(),m(),m(),m(),m(),m(),m(),m(Array.isArray(e.header_replacements)&&e.header_replacements?.filter((t=>"title"!=t.type))),m("images"in e.body_substitutions&&Object.keys(e.body_substitutions?.images)),m("links"in e.body_substitutions&&Object.keys(e.body_substitutions?.links)),Object.entries(r).forEach((t=>{m((t[0],t[1]))})),m(),m()},w=()=>{const t=document.querySelectorAll('[data-otto-pixel="dynamic-seo"],[data-otto-pixel="searchatlas"]');if(t.length>0)try{t.forEach((t=>t.remove()))}catch(t){}},g=()=>{m();const t=document.getElementById("sa-otto")?.getAttribute("data-uuid")||document.getElementById("searchatlas")?.getAttribute("data-uuid")||document.getElementById("sa-dynamic-optimization")?.getAttribute("data-uuid");window.otto_js_installed=!0,window.otto_js_uuid=t,m();try{const e=history.pushState;history.pushState=function(){e.apply(history,arguments),window.dispatchEvent(new Event("locationchange"))},window.onpopstate=function(){window.dispatchEvent(new Event("locationchange"))},window.addEventListener("locationchange",(()=>{w(),h(window.location.origin+window.location.pathname,t),u(window.location.href,t,null)}))}catch(t){m()}window.onload=function(){h(window.location.origin+window.location.pathname,t),u(window.location.href,t,null),m();performance.getEntriesByType("navigation").forEach((t=>{t.domContentLoadedEventEnd,t.startTime}));window,window}};g();